<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard | Gyanodaya Admin</title>
  <link rel="stylesheet" href="admin.css">
</head>

<body>
  <div class="layout">
    <aside class="sidebar">
      <!-- Sidebar content injected by admin.js -->
    </aside>

    <main class="content">
      <h1>Dashboard</h1>
      <p class="page-desc">Overview of your school's website content.</p>

      <div class="dashboard-grid">
        <div class="stat-card">
          <h4>Page Sections</h4>
          <div class="value" id="sectionCount">0</div>
        </div>
        <div class="stat-card">
          <h4>Active Notices</h4>
          <div class="value" id="noticeCount">0</div>
        </div>
        <div class="stat-card">
          <h4>Admission Enquiries</h4>
          <div class="value" id="admissionCount">0</div>
        </div>
        <div class="stat-card">
          <h4>Faculty & Staff</h4>
          <div class="value" id="facultyCount">0</div>
        </div>
        <div class="stat-card">
          <h4>Media Files</h4>
          <div class="value" id="assetCount">0</div>
        </div>
        <div class="stat-card">
          <h4>Special Records</h4>
          <div class="value" id="recordCount">0</div>
        </div>
        <div class="stat-card">
          <h4>Management</h4>
          <div class="value" id="managementCount">0</div>
        </div>
      </div>

      <div class="card" style="margin-top: 30px; border-left: 5px solid var(--primary);">
        <h3><i class="fas fa-rocket"></i> Welcome to Gyanodaya Admin</h3>
        <p>Your website is now fully manageable. Every page has its own dedicated editor in the sidebar. You can upload
          photos, manage fee tables, track admissions, and update the academic calendar instantly.</p>
      </div>
    </main>
  </div>

  <script type="module">
    import { protectPage, initSidebar, api } from "./admin.js";

    async function init() {
      await protectPage();
      initSidebar();

      try {
        const [sections, notices, admissions, assets, records, faculty, management] = await Promise.all([
          api("/api/sections"),
          api("/api/notices"),
          api("/api/admissions"),
          api("/api/assets"),
          api("/api/records"),
          api("/api/people?type=faculty"),
          api("/api/people?type=management")
        ]);

        document.getElementById("sectionCount").textContent = sections.length;
        document.getElementById("noticeCount").textContent = notices.length;
        document.getElementById("admissionCount").textContent = admissions?.length || 0;
        document.getElementById("assetCount").textContent = assets.length;
        document.getElementById("recordCount").textContent = records.length;
        document.getElementById("facultyCount").textContent = faculty.length;
        document.getElementById("managementCount").textContent = management.length;
      } catch (err) {
        console.error("Failed to load dashboard stats", err);
      }
    }

    init();
  </script>
</body>

</html>